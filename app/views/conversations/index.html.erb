<% content_for :header do %>
  <div class="flex text-white py-4">
    <%= link_to feed_path, class: 'text-white absolute top-[23px] pl-[20px]' do %>
      <%= image_tag 'arrow_back.png' %>
    <% end %>
    <h2 class="mr-auto ml-auto text-2xl">Messages</h2>
  </div>
<% end %>

<div class="h-screen flex flex-col bg-white">
  <%# Add flash messages %>
  <% if flash[:alert] %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
      <span class="block sm:inline"><%= flash[:alert] %></span>
    </div>
  <% end %>

  <%# Add the search form at the top %>
  <%= render 'search_form' %>

  <%= turbo_frame_tag "conversations-list" do %>
    <div class="flex-1 overflow-y-auto" data-live-search-target="results">
      <%= render 'conversations_list', conversations: @conversations %>
    </div>
  <% end %>

  <%# Modal for creating a new conversation %>
  <%= render 'new_conversation_modal' %>
</div>

<!-- Sliding Panel Overlay -->
<div id="new-conversation-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300 opacity-0"></div>

<!-- Challenges Sliding Panel -->
<div id="new-conversation-panel" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-3xl z-50 transform translate-y-full transition-transform duration-300 ease-in-out">
    <button id="close-new-conversation-panel" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
        const openButton = document.getElementById('new-conversation-button');
        const challengesPanel = document.getElementById('new-conversation-panel');
        const challengesOverlay = document.getElementById('new-conversation-overlay');
         const closeCreatePanel = document.getElementById('close-new-conversation-panel');

        if (openButton) {
            openButton.addEventListener('click', function() {
              challengesOverlay.classList.remove('hidden');
              void challengesOverlay.offsetWidth; // Trigger reflow
              challengesOverlay.classList.remove('opacity-0');

              challengesPanel.classList.remove('translate-y-full');
              challengesPanel.classList.add('h-1/2');

            });
        }

        if (challengesOverlay) {
            challengesOverlay.addEventListener('click', function() {
              challengesOverlay.classList.add('hidden');
              challengesOverlay.classList.add('opacity-0');

              challengesPanel.classList.add('translate-y-full');
            });
        }

        if (closeCreatePanel) {
            closeCreatePanel.addEventListener('click', function() {
              challengesOverlay.classList.add('hidden');
              // closeCreatePanel.classList.add('hidden');
              challengesOverlay.classList.add('opacity-0');

              challengesPanel.classList.add('translate-y-full');

            });
        }
});
</script>