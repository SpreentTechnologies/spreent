<% content_for :header do %>
    <div class="flex">
        <%= image_tag "spreent_logo.png", class: 'w-[150px] h-[50px]' %>
        <div class="absolute right-0 top-[21px] flex pr-[7px]">
            <%= link_to notifications_path, class: 'text-white w-[28px] h-[28px]' do %>
                <i class="fa-solid fa-bell"></i>
            <% end %>

            <%= link_to conversations_path, class: 'text-white w-[28px] h-[28px]' do %>
              <i class="fa-solid fa-message"></i>
              <% if current_user.unread_messages_count > 0 %>
                <span class="relative bottom-[40px] left-[4px] bg-[#E8C0FF] w-[10px] rounded-full p-1 text-[10px]"><%= current_user.unread_messages_count %></span>
                <% end %>
            <% end %>
        </div>
    </div>
<% end %>

  <%= render 'shared/search_bar' %>
    <div class="communities_pills"></div>
    <hr />
    <div class="pl-[20px] pt-[10px] flex border-none opacity-100 translate-y-0 transform transition-all duration-300 ease-in-out" data-controller="file-upload">
        <div class="share-something-avatar">
            <% if current_user.avatar.attached? %>
                <%= image_tag current_user.avatar.variant(resize_to_limit: [50, 50]),
                    class: 'w-[50px] h-[50px] rounded-full object-cover object-center border-3 border-gray-300',
                    alt: "#{current_user.email}'s avatar"
                %>
            <% else %>
                <%= image_tag 'default_avatar.png',
                    class: 'w-[50px] h-[50px] rounded-full object-cover object-center border-3 border-gray-300 mr-[15px]',
                    alt: 'Default avatar'
                %>
            <% end %>
        </div>

        <div class="w-[80%]">
            <%= turbo_frame_tag "new_post_form" do %>
                <%= form_with(model: @new_post, local: false, html: {
                    class: 'post-form',
                    data: {
                        controller: 'file-upload',
                        action: 'file-upload:progress->turbo-frame#update'
                    }
                }) do |form| %>
                    <% if @new_post.errors.any? %>
                      <div class="error_messages">
                        <% @new_post.errors.full_messages.each do |message| %>
                          <p class="text-danger"><%= message %></p>
                        <% end %>
                      </div>
                    <% end %>

                    <div class="text-black ml-2.5 absolute right-9 w-6 h-6 mt-2.5 cursor-pointer" data-action="click->file-upload#triggerFileInput">
                        <i class="fa-solid fa-image"></i>
                    </div>

                    <div class="field">
                      <%= form.text_area :content,
                          placeholder: I18n.t('feed.share_something'),
                          class: 'form-control share-content w-[85%] resize-none',
                          rows: 3
                      %>
                    </div>

                    <div class="form-group media-upload">
                      <div class="media-input-wrapper">
                        <%= form.file_field :media,
                            multiple: true,
                            accept: 'image/png,image/jpeg,image/gif,video/mp4,video/quicktime',
                            class: 'form-control-file hidden-file-input',
                            style: 'display: none;',
                            direct_upload: true,
                            data: {
                              file_upload_target: "fileInput"
                            }
                        %>

                        <div class="selected-files" data-file-upload-target="fileList"></div>

                        <div id="upload-preview"></div>
                      </div>
                    </div>

                    <%= form.submit I18n.t('feed.create_post'), class: 'text-white py-[12px] px-[30px] mb-[50px] hover:-translate-y-0.5 hover:shadow-[0_4px_8px_rgba(94,97,231,0.4)] active:translate-y-0.5 active:shadow-[0_1px_3px_rgba(94,97,231,0.4)] transition-all duration-300 ease-in-out rounded-3xl text-xl transition-all duration-300 ease-in-out cursor-pointer ml-auto mr-auto border-none bg-gradient-to-r from-[#5e61e7] to-[#8d7dfa] shadow-[0_2px_5px_rgba(94,97,231,0.3)]' %>
                <% end %>
            <% end %>
        </div>


    </div>

<div data-controller="infinite-scroll">
    <%= turbo_frame_tag "posts_list", data: { turbo_action: "advance" } do %>
        <div class="overflow-y-scroll overflow-x-hidden h-[calc(100vh-225px)] scrollbar-hide" id="posts" data-infinite-scroll-target="container">
            <%= render @posts %>
        </div>
    <% end %>

  <div data-infinite-scroll-target="scrollTrigger" class="py-2 -mb-2 flex justify-center">

  <div id="loading-indicator" data-infinite-scroll-target="loadingIndicator" class="h-24 fixed bottom-5 w-[25px] hidden">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
      <style>
          .spinner {
              transform-origin: center;
              animation: rotate 1.5s linear infinite;
          }
          @keyframes rotate {
              from { transform: rotate(0deg); }
              to { transform: rotate(360deg); }
          }
      </style>
      <g class="spinner">
        <circle cx="50" cy="50" r="45" fill="none" stroke="#eaeaea" stroke-width="8"/>
        <path d="M50 5 A 45 45 0 0 1 95 50" fill="none" stroke="#6a0dad" stroke-width="8" stroke-linecap="round"/>
      </g>
    </svg>
  </div>

  <div id="no-more-posts" data-infinite-scroll-target="noMorePosts" class="hidden">
    No more posts to load
  </div>
</div>